---
layout: post
title:  Fast Fourier Transform in Unity
tags: misc
---

A fast fourier transform is an algorithm that basically creates a frequency domain representation of a sequence of sinusoidal waves in the time domain.

What this does is allows us to get the amplitudes of each frequency within a given cycle of the original audio input.  This data can then be used to do anything from making a game reactive to sound to driving a visualization engine.

Here's how to do it in Unity:

1. Luckily, Unity provides their own implementation of the FFT within the [AudioSource](https://docs.unity3d.com/ScriptReference/AudioSource.html) class.
  - To use it, we just need to call the [AudioSource.GetSpectrumData(float[] samples, int channel, FFTWindow window)](https://docs.unity3d.com/ScriptReference/AudioSource.GetSpectrumData.html) method and pass it a float array, an int representing the channel we want to sample from and a FFTWindow enum, which depending on what window you choose can increase the accuracy of the FFT by reducing leakage across frequency bands, but it also costs more in processing power.
  <script src="https://gist.github.com/alec-chan/733d687f0bc7d24f7728f360ba88192e.js"></script>

2. We're pretty much there at this point, thanks to Unity providing the algorithm so we don't have to write the implementation ourselves, but now we need to do something with this data.
  - I've created a small audio visualizer composed of a circle of n number of cubes on the x-z plane which each represent a band of the 1024 frequency bands that we collect from the music every frame.  If there are less than 1024 cubes, then the program just takes the middle n frequency bands and stretches the cubes' y axes proportionally to the amplitude of that frequency. Additionally, I placed a Point Light in the center of the ring whose intensity responds to the amplitude of each frequency band and particles whose startSize responds to the amplitude. You can link any property of any object to the frequency bands' amplitudes to have it respond to the audio.  You could even go further and have something react only to certain frequencies which you can specify using the index of the _samples array.

3. Check out the full code below the video.

  {% include videoplayer.html url="2017-03-30.webm" type="video/webm" %}

<script src="https://gist.github.com/alec-chan/a0fd27080996763ee2829c01a820b24e.js"></script>


